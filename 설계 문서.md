# 아기고래 쿠아 게임 설계 문서

## 📋 프로젝트 개요

### 게임 컨셉
- **장르**: 2D 액션 생존 게임
- **플랫폼**: 웹 브라우저 (HTML5 Canvas)
- **타겟**: 전연령층 캐주얼 게이머
- **핵심 메커니즘**: 약육강식 생존, 단계적 성장

### 게임 목표
플레이어는 작은 아기고래 쿠아를 조작하여 작은 물고기를 먹으며 성장하고, 큰 적들을 피해 레벨 10까지 달성하는 것이 목표입니다.

## 🎮 게임플레이 설계

### 핵심 루프
1. **이동** → 2. **먹이 탐색** → 3. **적 회피** → 4. **성장** → 5. **레벨업** → 1번으로 순환

### 조작 방식
- **방향키/WASD**: ↑↓←→ 또는 WASD 쿠아 이동
- **마우스 클릭 & 드래그**: 마우스 위치로 이동 + 클릭 시 대시
- **스페이스바**: 재시작 (게임오버/승리 시)
- **ESC키**: 일시정지/재개

### 승리/패배 조건
- **승리**: 레벨 10 달성 (클리어 시간 표시)
- **패배**: 적 물고기나 상어, 성게와 충돌 (플레이 시간 표시)

## 🐋 게임 오브젝트 설계

### 1. 플레이어 캐릭터 (쿠아)
```javascript
player = {
    x: 200,           // 중앙 시작
    y: 200,
    radius: 15,       // 초기 크기
    speed: 3,         // 이동 속도
    color: "#4A90E2", // 파란색
    level: 1,
    score: 0,
    isInvincible: false,
    invincibleTime: 0
}
```

**성장 공식**: `새로운 크기 = 15 + (레벨-1) * 3 + 먹은_먹이_수`

### 2. 먹이 (작은 물고기)
```javascript
food = {
    x: Math.random() * 380 + 10,  // 랜덤 위치
    y: Math.random() * 380 + 10,
    radius: 5,
    color: "#FF6B6B",             // 빨간색
    value: 10                     // 점수
}
```

**생성 규칙**: 
- 초기 20개 (화면 크기 확장으로 증가)
- 화면 네 방향(상하좌우)에서 자연스럽게 등장
- 이동 방향을 향해 얼굴 방향 설정
- 화면 밖으로 이동 시 자연스럽게 소멸

### 3. 적 물고기
```javascript
enemy = {
    x: Math.random() * 300 + 50,
    y: Math.random() * 300 + 50,
    radius: 25,
    speed: 1,                     // 느린 이동
    color: "#2C3E50",            // 검은색
    directionX: Math.random() * 2 - 1,  // -1 ~ 1
    directionY: Math.random() * 2 - 1
}
```

**AI 패턴**: 
- 화면 네 방향에서 등장하여 직선 이동
- 이동 방향을 향해 얼굴 방향 자동 조정
- 화면 밖으로 이동 시 자연스럽게 제거

### 4. 상어 (6레벨부터)
```javascript
shark = {
    x: 50,
    y: 50,
    size: 45,
    speed: 1.3,
    color: "#708090",            // 회색
    isActive: false
}
```

**AI 패턴**:
- 플레이어 추적 (벡터 기반 이동)
- 이동 방향에 따른 상어 모양 회전 (좌우만)
- 레벨별 상어 수량 조절 (6-7레벨:1마리, 8-9레벨:2마리, 10레벨:3마리)
- 화면 밖으로 이동 시 자연스럽게 제거

### 5. 특수 아이템 (무적 아이템)
```javascript
powerup = {
    x: Math.random() * 360 + 20,
    y: Math.random() * 360 + 20,
    radius: 10,
    color: "#FFD700",            // 금색 (별 모양)
    duration: 3000,              // 3초 무적
    spawnChance: 0.3             // 30% 확률
}
```

**특징**:
- 별 모양 (5개 꼭지점)
- 천천히 회전하며 글로우 효과
- 화면 4방향에서 등장하여 지나감
- 획득 시 3초간 무적 + 보호막 시각 효과

### 6. 장애물 (성게)
```javascript
urchin = {
    x: Math.random() * 700 + 50,
    y: -20 or 820,               // 위 또는 아래에서 등장
    radius: 20,
    speedX: 0,
    speedY: 0.5 or -0.5,         // 수직 이동
    color: "#8B008B"             // 보라색
}
```

**특징**:
- 보라색 몸체 + 12개 가시
- 위 또는 아래에서만 등장하여 수직으로 지나감
- 충돌 시 페널티: 경험치 -1, 스테미나 -30, 3초간 50% 속도 감소
- 화면 밖으로 이동 시 제거
- 게임 시작 시 3개 초기 스폰

## 🎨 비주얼 설계

### 화면 구성
```
┌─────────────────────────────────────────────────┐
│ Score: 1250  Level: 7  🎵 효과음: ON        │ ← UI 바
├─────────────────────────────────────────────────┤
│                                                 │
│    🔴→    🐋→    🔴→   ⚡                     │
│                                                 │
│  ⚫↓      🔴↗    ⚫↓    🦈→                   │ ← 게임 영역
│                                                 │ (800x760px)
│     🔴←           🔴↖       ⚫↑               │
│                                                 │
├─────────────────────────────────────────────────┤
│              ●●●○○○○○○○ 7/10                │ ← 레벨 진행도
└─────────────────────────────────────────────────┘
```

### 물고기 단계별 색상 및 특징 (최신)
1. **1단계**: `#FFD700` (밝은 노란색) - 단일 꼬리
2. **2단계**: `#FF8C00` (주황색) - 단일 꼬리
3. **3단계**: `#FF4500` (오렌지레드) - **이중 꼬리**
4. **4단계**: `#C71585` (미디엄 바이올렛 레드) - 이중 꼬리
5. **5단계**: `#8B008B` (진한 마젠타) - 이중 꼬리
6. **6단계**: `#4B0082` (인디고) - **삼중 꼬리**
7. **7단계**: `#6B0041` (다크 버건디) - 삼중 꼬리
8. **8단계**: `#8B0000` (어두운 빨간색) - 삼중 꼬리

### 직관적 테두리 시스템
- **흰색 테두리**: 먹을 수 있는 물고기 (안전)
- **빨간 테두리**: 위험한 물고기/상어 (적)
- **테두리 두께**: 크기 비례 (최소 2px)

### 기타 색상
- **배경**: 바다색 그라데이션 (`#87CEEB` → `#4682B4` → `#191970`) + 해초/물방울 장식
- **쿠아**: `#4A90E2` (파란색) + 흰색 테두리
- **상어**: `#708090` (슬레이트 회색) + 빨간 테두리
- **무적템**: `#FFD700` (금색 별)
- **성게**: `#8B008B` (진한 보라색)
- **UI 텍스트**: `#2C3E50`

### 캐릭터 디테일
**쿠아 (타원형 + 방향성)**:
- 이동 방향에 따른 꼬리 표시
- 흰색 테두리로 명확한 식별
- 입 제거로 심플한 디자인
- 크기 변화에 따른 동적 스케일링

**물고기 (타원형 + 단계별 차별화)**:
- **1-2단계**: 단일 꼬리 (초보자용)
- **3-5단계**: 이중 꼬리 (중급형)
- **6-8단계**: 삼중 꼬리 (고급형)
- 좌우 방향만 바라보도록 설정 (위아래 지향 제거)
- 적/먹이 상태에 따른 테두리 색상 변화

**상어 (삼각형 + 추적)**:
- 플레이어 추적 시 좌우 방향만 조정 (상하 반전 방지)
- 지느러미가 위, 이빨이 아래로 올바른 방향
- 모든 부위에 빨간 테두리 적용
- 크기: 45px (위협적인 존재감)
- 자연스러운 퇴장 (화면 밖으로 이동 시 제거)

**성게 (원형 + 가시)**:
- 보라색 원형 몸체
- 12개 가시가 방사형으로 배치
- 위/아래 수직 이동만 (화면 상하단 진입/퇴장)
- 빨간 테두리로 위험 표시

### UI 개선사항
**레벨/스테미나 시스템**:
- 레벨 동그라미: 왼쪽 (280px, 760px)
- 스테미나 바: 오른쪽 (320-480px, 760px)
- 흰색 테두리로 명확한 구분

**물고기 도감 (상단)**:
- 등장 예정 물고기 미리보기
- 실시간 적/먹이 상태 표시
- 숫자 제거로 깔끔한 디자인
- 상어 등장 시점 표시 (6레벨부터)

## ⚙️ 기술적 구현 설계

### 파일 구조
```
baby-whale-cua/
├── index.html        (메인 게임 파일)
├── music/            (배경 음악 폴더)
│   ├── 1.mp3        (1-2 레벨)
│   ├── 2.mp3        (3-5 레벨)
│   ├── 3.mp3        (6-7 레벨)
│   └── 4.mp4        (8-10 레벨)
├── README.md         (게임 설명)
└── screenshot.png    (선택사항)
```

### 핵심 함수 설계

#### 1. 게임 초기화
```javascript
function initGame() {
    // 캔버스 설정
    // 플레이어 초기화
    // 먹이 생성
    // 적 생성
    // 이벤트 리스너 등록
}
```

#### 2. 게임 루프
```javascript
function gameLoop() {
    update();    // 게임 상태 업데이트
    draw();      // 화면 렌더링
    requestAnimationFrame(gameLoop);
}
```

#### 3. 충돌 감지
```javascript
function checkCollision(obj1, obj2) {
    const dx = obj1.x - obj2.x;
    const dy = obj1.y - obj2.y;
    const distance = Math.sqrt(dx * dx + dy * dy);
    return distance < (obj1.radius + obj2.radius);
}
```

#### 4. 게임 상태 관리
```javascript
const gameState = {
    INTRO: 'intro',
    PLAYING: 'playing',
    GAME_OVER: 'gameOver',
    VICTORY: 'victory',
    PAUSED: 'paused'
};
```

#### 5. 음악 시스템
```javascript
// 레벨별 BGM 자동 전환 (페이드 인/아웃 효과)
function updateBGM() {
    let targetBGM = getBGMForLevel(player.level);
    if(targetBGM !== currentBGM) {
        fadeOut(currentBGM);
        currentBGM = targetBGM;
        fadeIn(currentBGM);
    }
}
```

#### 6. 마우스 제어
```javascript
// 마우스 위치로 이동 + 클릭 시 대시
// mouseleave 이벤트로 화면 밖 대시 방지
canvas.addEventListener('mouseleave', () => {
    mousePressed = false;
});
```

### 성능 최적화
- **오브젝트 풀링**: 먹이와 적을 재사용
- **렌더링 최적화**: 변경된 영역만 다시 그리기
- **충돌 감지 최적화**: 거리 기반 사전 필터링

## 📊 게임 밸런싱

### 난이도 곡선 (최신)
| 레벨 | 물고기 생성빈도 | 물고기 속도 | 상어 수 | 특별 요소 |
|------|----------------|-------------|---------|-----------|
| 1-2  | 1.5초마다      | 1.0x        | 0마리   | 기본 플레이 (단일 꼬리) |
| 3-5  | 1.3초마다      | 1.05x       | 0마리   | 이중 꼬리 등장 |
| 6-7  | 1.1초마다      | 1.1x        | 1마리   | **상어 등장!** |
| 8-9  | 0.9초마다      | 1.15x       | 2마리   | 상어 증가 |
| 10   | 0.7초마다      | 1.2x        | 3마리   | 최종 보스급 |

### 새로운 물고기 시스템
- **레벨별 등장**: 현재 레벨+1 단계까지 등장
- **8레벨 이후**: 모든 물고기가 먹이로 변환
- **크기 기반 판별**: 플레이어 크기 ≥ 물고기 크기면 먹기 가능

### 점수 시스템 (개선)
- **1단계**: +10점 | **2단계**: +20점 | **3단계**: +30점
- **4단계**: +40점 | **5단계**: +50점 | **6단계**: +60점
- **7단계**: +70점 | **8단계**: +80점
- **레벨업**: +50점 보너스 (물고기 5마리마다)
- **무적템**: +20점

### 스테미나 시스템
- **대쉬 속도**: 기본 속도의 2.5배
- **소모량**: 초당 120포인트 (약 1.7초 지속)
- **충전량**: 작은 물고기(1-3단계) 34포인트, 큰 물고기(4-8단계) 100포인트
- **자동 회복**: 초당 30포인트
- **마우스 제어**: 화면 밖으로 나가면 자동 대시 중단

### 성게 시스템
- **등장 방식**: 위 또는 아래에서만 등장 (좌우 없음)
- **이동 속도**: 0.5 (수직 이동만)
- **충돌 페널티**:
  - 경험치 -1
  - 스테미나 -30
  - 3초간 이동속도 50% 감소
- **초기 스폰**: 게임 시작 시 3개

## 🔧 개발 우선순위

### Phase 1 (MVP - 1일차)
1. ✅ 기본 이동 시스템
2. ✅ 먹이 시스템
3. ✅ 크기 증가
4. ✅ 점수 표시

### Phase 2 (기본 게임 - 1일차)
1. ✅ 적 물고기 추가
2. ✅ 충돌 감지
3. ✅ 게임오버 시스템
4. ✅ 레벨 시스템

### Phase 3 (완성도 향상 - 2일차)
1. ✅ 상어 시스템 (레벨별 스폰)
2. ✅ 특수 아이템 (무적, 보너스 피시)
3. ✅ 비주얼 개선 (방향성, 애니메이션)
4. ✅ 사운드 효과 (Web Audio API)
5. ✅ UI 개선 (레벨 인디케이터, 일시정지)
6. ✅ 4방향 스폰 시스템

### Phase 4 (추가 기능 - 3일차)
1. ✅ 배경 음악 시스템 (MP3 파일, 레벨별 자동 전환)
2. ✅ 페이드 인/아웃 효과
3. ✅ 스테미나 시스템 (대시 기능)
4. ✅ 마우스 조작 지원
5. ✅ 성게 장애물 추가
6. ✅ 별 모양 무적 아이템
7. ✅ 플레이/클리어 시간 표시
8. ✅ 보호막 시각 효과
9. ✅ 해양 테마 UI (해초, 물방울)

## 🐛 이슈 및 해결방안

### 해결된 이슈
1. **성능 저하**
   - 원인: 너무 많은 오브젝트 생성
   - 해결: 화면 밖 오브젝트 자동 제거, 4방향 스폰으로 분산

2. **충돌 감지 오류**
   - 원인: 부동소수점 연산 오차
   - 해결: 충돌 여백 적용, 정확한 반지름 계산

3. **게임 밸런스**
   - 원인: 너무 쉽거나 어려움
   - 해결: 플레이테스트 기반 수치 조정 (상어 속도 1.3, 무적템 30%)

4. **마우스 대시 버그**
   - 원인: 화면 밖으로 마우스 이동 시 대시 지속
   - 해결: mouseleave 이벤트로 자동 중단

5. **플레이 시간 증가 버그**
   - 원인: 게임 종료 후에도 시간이 계속 증가
   - 해결: 게임오버/승리 시점에 시간 저장 후 고정값 표시

6. **한글 폰트 깨짐**
   - 원인: Arial 폰트의 한글 지원 부족
   - 해결: Google Fonts Noto Sans KR 적용

## 📱 확장 가능성

### 추후 추가 기능
- **멀티플레이**: 실시간 대전 모드
- **아이템**: 속도 증가, 크기 축소 등
- **스킨**: 다양한 캐릭터 스킨
- **리더보드**: 온라인 점수 저장
- **모바일**: 터치 조작 지원

## 🎯 성공 지표
- ✅ **완성도**: 모든 레벨 클리어 가능
- ✅ **재미도**: 평균 플레이 시간 5분 이상
- ✅ **안정성**: 버그 없는 게임플레이
- ✅ **성능**: 60FPS 유지
- ✅ **사운드**: 레벨별 BGM + 효과음 완성
- ✅ **UI/UX**: 직관적인 조작 및 시각적 피드백

## 📝 최종 업데이트 내역 (2025년)

### 주요 변경사항
1. **배경 음악 시스템**
   - Web Audio API oscillator → MP3 파일 기반 시스템
   - 레벨별 4개 트랙 (1-2/3-5/6-7/8-10)
   - 부드러운 페이드 인/아웃 전환 효과

2. **무적 아이템 개선**
   - 원형 핑크색 → 금색 별 모양
   - 회전 애니메이션 + 글로우 효과
   - 등장 확률 15% → 30%로 증가
   - 보호막 시각 효과 (핑크 그라디언트)

3. **성게 장애물 추가**
   - 위/아래 수직 이동만
   - 충돌 시 디버프 (경험치 -1, 스테미나 -30, 3초 둔화)
   - 게임 시작 시 3개 스폰

4. **마우스 조작 개선**
   - 클릭 & 드래그로 대시 기능
   - 화면 밖 이탈 시 자동 대시 중단

5. **시간 표시 시스템**
   - 승리 시: 클리어 시간 표시
   - 게임오버 시: 플레이 시간 표시
   - 시간 고정 (종료 후 증가 방지)

6. **폰트 개선**
   - Google Fonts Noto Sans KR 적용
   - 한글 텍스트 깨짐 해결
